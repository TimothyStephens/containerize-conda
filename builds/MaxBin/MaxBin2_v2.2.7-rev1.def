Bootstrap: docker
From: ubuntu:20.04

%files
  packed_env.tar /packed_env.tar

%environment
  export LC_ALL=C
  export NUMBA_CACHE_DIR=/tmp/numba_cache

%post
  # So we dont have to interactivly configure tzdata 
  ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime
  DEBIAN_FRONTEND=noninteractive
  
  # Install essential packages
  apt-get update && apt-get -y upgrade
  apt-get -y install \
    build-essential \
    curl \
    bzip2 \
    ca-certificates \
    libglib2.0-0 \
    libxext6 \
    libsm6 \
    libxrender1 \
    git
  rm -rf /var/lib/apt/lists/*
  apt-get clean

  # Installing Miniconda 3
  curl https://repo.anaconda.com/miniconda/Miniconda3-py311_23.10.0-1-Linux-x86_64.sh > /install_conda.sh
  chmod +x /install_conda.sh
  /install_conda.sh -b -p /opt/conda
  rm /install_conda.sh
  tar xvf /packed_env.tar
  rm /packed_env.tar
  echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
  echo "conda activate {conda_env}" >> $SINGULARITY_ENVIRONMENT

%labels
  Program MaxBin2
  ProgramVersion v2.2.7
  ContainerVersion 1
  Website https://sourceforge.net/projects/maxbin/

%help

########################
#### MaxBin2 v2.2.7 ####
########################

MaxBin is a software for binning assembled metagenomic sequences based on an Expectation-Maximization algorithm. Users could understand the underlying bins (genomes) of the microbes in their metagenomes by simply providing assembled metagenomic sequences and the reads coverage information or sequencing reads. For users' convenience MaxBin will report genome-related statistics, including estimated completeness, GC content and genome size in the binning summary page. Users could use MEGAN or similar software on MaxBin bins to find out the taxonomy of each bin after the binning process is finished.


COMMANDS:  
  
  Print help message:
    singularity exec MaxBin2_v2.2.7-rev1.sif run_MaxBin.pl -h
  
  Basic run examples:
    singularity exec MaxBin2_v2.2.7-rev1.sif run_MaxBin.pl -thread 24 -contig final.contigs.fa -out maxbin -abund abundance.txt


